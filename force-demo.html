<!DOCTYPE html>
<html>
<head>
  <title>Force System Demo</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a2e;
      font-family: monospace;
      color: #f7fafc;
    }
    #container {
      display: flex;
      gap: 20px;
    }
    #app {
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      overflow: hidden;
    }
    #info {
      padding: 20px;
      background: #2d3748;
      border-radius: 8px;
      max-width: 400px;
    }
    h1 {
      margin-top: 0;
      font-size: 20px;
    }
    .controls {
      margin: 20px 0;
    }
    button {
      background: #48bb78;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    button:hover {
      background: #38a169;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: #1a202c;
      border-radius: 4px;
    }
    .section h2 {
      margin-top: 0;
      font-size: 16px;
      color: #4299e1;
    }
    code {
      background: #000;
      padding: 2px 6px;
      border-radius: 3px;
      color: #48bb78;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="app"></div>
    <div id="info">
      <h1>Force System Demo</h1>

      <div class="section">
        <h2>Controls</h2>
        <p>Arrow Keys: Apply directional forces</p>
        <p>Space: Apply upward impulse</p>
        <p>R: Reset</p>
      </div>

      <div class="section">
        <h2>Objects</h2>
        <p><strong>Light Ball (Green):</strong><br>mass = 0.5, responds quickly to forces</p>
        <p><strong>Heavy Ball (Blue):</strong><br>mass = 2, responds slowly to forces</p>
      </div>

      <div class="controls">
        <button id="windBtn">Toggle Wind (→)</button>
        <button id="gravityBtn">Toggle Gravity</button>
        <button id="resetBtn">Reset Scene</button>
      </div>

      <div class="section">
        <h2>About Forces</h2>
        <p>Forces use <code>F = ma</code> physics:</p>
        <ul style="font-size: 12px; line-height: 1.6;">
          <li>Call <code>applyForce(fx, fy)</code> to add forces</li>
          <li>Forces accumulate during the frame</li>
          <li>Converted to acceleration: <code>a = F/m</code></li>
          <li>Heavier objects (higher mass) accelerate slower</li>
          <li>Forces are cleared after each physics update</li>
        </ul>
      </div>
    </div>
  </div>

  <script type="module">
    import { Game, Scene, Sprite } from './dist/index.mjs';

    const game = new Game({
      parent: '#app',
      width: 600,
      height: 600,
      backgroundColor: '#0f1419'
    });

    let windEnabled = false;
    let gravityEnabled = true;
    const windForce = 200; // Force in pixels per second squared
    const thrustForce = 800;
    const jumpForce = 5000;

    function createScene() {
      const scene = new Scene();

      // Floor
      const floor = new Sprite({
        x: 300,
        y: 580,
        width: 600,
        height: 40,
        color: '#2d3748',
        static: true,
        checkCollisions: true,
        bounciness: 0.6
      });
      scene.add(floor);

      // Left wall
      const leftWall = new Sprite({
        x: 10,
        y: 300,
        width: 20,
        height: 600,
        color: '#2d3748',
        static: true,
        checkCollisions: true,
        bounciness: 0.8
      });
      scene.add(leftWall);

      // Right wall
      const rightWall = new Sprite({
        x: 590,
        y: 300,
        width: 20,
        height: 600,
        color: '#2d3748',
        static: true,
        checkCollisions: true,
        bounciness: 0.8
      });
      scene.add(rightWall);

      // Light ball (low mass - responds quickly)
      const lightBall = new Sprite({
        x: 200,
        y: 100,
        width: 50,
        height: 50,
        radius: 25,
        color: '#48bb78',
        vx: 0,
        vy: 0,
        mass: 0.5,
        gravity: gravityEnabled ? 980 : 0,
        friction: 0.99,
        bounciness: 0.8,
        checkCollisions: true
      });
      scene.add(lightBall);

      // Heavy ball (high mass - responds slowly)
      const heavyBall = new Sprite({
        x: 400,
        y: 100,
        width: 50,
        height: 50,
        radius: 25,
        color: '#4299e1',
        vx: 0,
        vy: 0,
        mass: 2,
        gravity: gravityEnabled ? 980 : 0,
        friction: 0.99,
        bounciness: 0.8,
        checkCollisions: true
      });
      scene.add(heavyBall);

      // Keyboard controls
      const keys = {};
      window.addEventListener('keydown', (e) => {
        keys[e.key.toLowerCase()] = true;

        if (e.key === ' ') {
          e.preventDefault();
          // Apply strong upward impulse (jump)
          lightBall.applyForce(0, -jumpForce);
          heavyBall.applyForce(0, -jumpForce);
        }

        if (e.key.toLowerCase() === 'r') {
          // Reset positions
          lightBall.x = 200;
          lightBall.y = 100;
          lightBall.vx = 0;
          lightBall.vy = 0;
          heavyBall.x = 400;
          heavyBall.y = 100;
          heavyBall.vx = 0;
          heavyBall.vy = 0;
        }
      });

      window.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
      });

      // Update loop - apply forces based on keyboard input
      scene.on('update', (dt) => {
        // Apply directional thrust forces
        if (keys['arrowleft']) {
          lightBall.applyForce(-thrustForce, 0);
          heavyBall.applyForce(-thrustForce, 0);
        }
        if (keys['arrowright']) {
          lightBall.applyForce(thrustForce, 0);
          heavyBall.applyForce(thrustForce, 0);
        }
        if (keys['arrowup']) {
          lightBall.applyForce(0, -thrustForce);
          heavyBall.applyForce(0, -thrustForce);
        }
        if (keys['arrowdown']) {
          lightBall.applyForce(0, thrustForce);
          heavyBall.applyForce(0, thrustForce);
        }

        // Apply wind force if enabled
        if (windEnabled) {
          lightBall.applyForce(windForce, 0);
          heavyBall.applyForce(windForce, 0);
        }
      });

      return scene;
    }

    let currentScene = createScene();
    game.setScene(currentScene);
    game.start();

    // UI Controls
    document.getElementById('windBtn').addEventListener('click', () => {
      windEnabled = !windEnabled;
      document.getElementById('windBtn').textContent =
        windEnabled ? 'Wind: ON (→)' : 'Toggle Wind (→)';
    });

    document.getElementById('gravityBtn').addEventListener('click', () => {
      gravityEnabled = !gravityEnabled;
      const entities = currentScene.getEntities();
      entities.forEach(entity => {
        if (entity.gravity !== undefined) {
          entity.gravity = gravityEnabled ? 980 : 0;
        }
      });
      document.getElementById('gravityBtn').textContent =
        gravityEnabled ? 'Gravity: ON' : 'Gravity: OFF';
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      game.stop();
      currentScene = createScene();
      game.setScene(currentScene);
      game.start();
      windEnabled = false;
      gravityEnabled = true;
      document.getElementById('windBtn').textContent = 'Toggle Wind (→)';
      document.getElementById('gravityBtn').textContent = 'Toggle Gravity';
    });
  </script>
</body>
</html>
